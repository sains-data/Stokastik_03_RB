---
title: "tubes pemstok"
author: "kelmpok 3 rb"
date: "2025-11-20"
output: html_document
---
```{r}
#install.packages("markovchain")
#install.packages("expm")
#install.packages("diagram")
#install.packages("ggplot2")
```

```{r}
#library(markovchain)
#library(expm)
#library(diagram)
#library(ggplot2)
```

```{r}
# Inisiasi Data
# Data Waktu (08:00 - 16:00, interval 10 menit)
waktu <- c(
  "08:00", "08:10", "08:20", "08:30", "08:40", "08:50", 
  "09:00", "09:10", "09:20", "09:30", "09:40", "09:50", 
  "10:00", "10:10", "10:20", "10:30", "10:40", "10:50", 
  "11:00", "11:10", "11:20", "11:30", "11:40", "11:50", 
  "12:00", "12:10", "12:20", "12:30", "12:40", "12:50", 
  "13:00", "13:10", "13:20", "13:30", "13:40", "13:50", 
  "14:00", "14:10", "14:20", "14:30", "14:40", "14:50", 
  "15:00", "15:10", "15:20", "15:30", "15:40", "15:50", "16:00"
)

# Data Jumlah Pengunjung 
jumlah_pengunjung <- c(
  9, 9, 12, 11, 15, 15, 
  16, 20, 24, 32, 36, 43, 
  53, 64, 72, 73, 82, 84, 
  85, 82, 76, 81, 85, 83, 
  77, 80, 83, 82, 82, 78, 
  70, 66, 74, 85, 88, 94, 
  92, 89, 85, 85, 92, 92, 
  88, 87, 80, 74, 69, 56, 53
)

# Membuat Data Frame
df <- data.frame(
  Waktu = waktu,
  Jumlah = jumlah_pengunjung
)

# Batas: 33 (Sepi) dan 66 (Sedang), sisanya Ramai
get_state <- function(x) {
  if (is.na(x)) return(NA)
  if (x <= 33) return("Sepi")
  else if (x <= 66) return("Sedang")
  else return("Ramai")
}

# Terapkan State Baru
df$State <- sapply(df$Jumlah, get_state)
# Urutkan level agar matriks rapi (Sepi -> Sedang -> Ramai)
df$State <- factor(df$State, levels = c("Sepi", "Sedang", "Ramai"))

head(df)
```

```{r}
# Buat Data Frame
df_grafik <- data.frame(Waktu = factor(waktu, levels = waktu), Jumlah = jumlah_pengunjung)

ggplot(data = df_grafik, aes(x = Waktu, y = Jumlah, group = 1)) +
  # Garis dan Titik
  geom_line(color = "blue", size = 1) +
  geom_point(color = "red", size = 2) +
  
  # Label dan Judul
  labs(
    title = "Grafik Observasi Jumlah Pengunjung Perpustakaan GKU 2",
    subtitle = "Data Pengamatan Harian (08:00 - 16:00)",
    x = "Waktu (Interval 10 Menit)",
    y = "Jumlah Pengunjung"
  ) +
  
  # Tampilan agar rapi
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5))
```


```{r}
# HITUNG MATRIKS TRANSISI
hitung_matriks_harian <- function(dataframe_full) {
  states <- c("Sepi", "Sedang", "Ramai")
  matriks_count <- matrix(0, nrow = 3, ncol = 3, dimnames = list(states, states))
  
  n <- nrow(dataframe_full)
  
  # Loop dari awal sampai akhir data
  for (i in 1:(n-1)) {
    state_sekarang <- as.character(dataframe_full$State[i])
    state_besok <- as.character(dataframe_full$State[i+1])
    
    matriks_count[state_sekarang, state_besok] <- matriks_count[state_sekarang, state_besok] + 1
  }
  
  # Normalisasi ke Probabilitas
  matriks_prob <- matrix(0, nrow = 3, ncol = 3, dimnames = list(states, states))
  for (i in 1:3) {
    total_row <- sum(matriks_count[i, ])
    if (total_row > 0) {
      matriks_prob[i, ] <- matriks_count[i, ] / total_row
    } else {
      matriks_prob[i, i] <- 1.0 
    }
  }
  return(matriks_prob)
}

# Eksekusi Perhitungan
P_harian <- hitung_matriks_harian(df)

cat("\nMATRIKS TRANSISI\n")
print(P_harian)
```

```{r}
cat("\nSIMULASI PEMANGKATAN MATRIKS (Mencari Steady State)\n")

# Pangkat Menengah (Misal n=10 atau 100 menit ke depan)
n_mid <- 10
P_mid <- P_harian %^% n_mid

cat("\nMatriks Pangkat", n_mid, "(Prediksi 100 Menit)\n")
print(P_mid)

# Pangkat Besar/Limit (Misal n=100 atau 1000 menit ke depan)
n_limit <- 100
P_limit <- P_harian %^% n_limit

cat("\nMatriks Limit Pangkat", n_limit, "(Steady State Matrix)\n")
print(P_limit)

# Ambil Hasil Akhir (Vektor Distribusi Stasioner)
pi_vector <- P_limit[1, ]
names(pi_vector) <- c("Sepi", "Sedang", "Ramai")

cat("\nKESIMPULAN DISTRIBUSI STASIONER (pi)\n")
print(pi_vector)

# Interpretasi
max_state_index <- which.max(pi_vector)
states_name <- c("Sepi", "Sedang", "Ramai")

cat("\nKESIMPULAN:\n")
cat("Dalam jangka panjang, sistem memiliki kecenderungan alami paling kuat\n")
cat("untuk berada pada kondisi:", states_name[max_state_index], "\n")
cat("Probabilitas:", round(max(pi_vector)*100, 1), "%\n") 
```


```{r}
# ANALISIS PREDIKSI 
# Prediksi 30 Menit (n=3)
n <- 3
P3_harian <- P_harian %^% n

cat("\nPREDIKSI 30 MENIT KE DEPAN (P^3)\n")
print(P3_harian)
```


```{r}
par(mar = c(2, 2, 2, 2)) 

plotmat(t(P_harian), pos = c(1,2), 
        name = c("Sepi", "Sedang", "Ramai"), 
        box.type = "circle", box.prop = 0.5, box.size = 0.1,
        main = "Diagram Transisi Siklus Jam Buka - Tutup", 
        arr.length = 0.3, arr.width = 0.2, self.cex = 0.8)
```



